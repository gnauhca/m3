{"version":3,"sources":["webpack:///./js/display.js","webpack:///./js/product-preview.js","webpack:///./js/welcome.js"],"names":[],"mappings":";;;;;AAAA;;AAEA,EAAC,E;;;;;;;ACFD;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,oBAAmB;;AAEnB;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA,0BAAyB,iBAAiB;AAC1C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA,oBAAmB,SAAS;AAC5B;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,KAAI,E;AACJ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAI;;AAEJ;AACA;AACA,KAAI;AACJ;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA,KAAI;AACJ,IAAG;;AAEH;AACA;AACA;AACA,IAAG;AACH;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,gB;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,EAAC;;AAED;;;;AAIA;AACA;AACA;AACA;;AAEA;AACA,gBAAe;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;;AAEA;AACA,6BAA4B;;;AAG5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;AACF;AACA;;AAEA;AACA;AACA,+BAA8B;;AAE9B;AACA,iBAAgB;AAChB,mB;;AAEA;AACA,mB;AACA;AACA;AACA;AACA,sD;AACA,GAAE;;;AAGF;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE,E;AACF,EAAC,E;;;;;;;;ACrRD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH,W;AACA;AACA;;AAEA;AACA,+BAA8B;AAC9B;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,IAAG,E;AACH;AACA,G;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,4B;;AAEA;;AAEA,kBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAoB;AACpB,YAAW;AACX;AACA;;AAEA;AACA;AACA,mCAAkC;AAClC,oBAAmB;;AAEnB;;AAEA;AACA;AACA;AACA;AACA;AACA,iGAAgG;;AAEhG;AACA;AACA;AACA;;AAEA,IAAG;;AAEH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,6DAA4D,yCAAyC,QAAQ;AAC7G;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA,KAAI;;AAEJ;;AAEA;AACA,4BAA2B;AAC3B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA,EAAC;;AAED","file":"1.index.js","sourcesContent":["var ViewDisplay = Class.extend(function() {\n\t\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./js/display.js\n ** module id = 12\n ** module chunks = 1\n **/","var View = require('./view.js');\nvar DisplayManager = require('./display-manager.js');\n\nvar ProductsPreview = View.extend(function() {\n\tthis.name = 'product-preview';\n\n\tvar that = this;\n\tvar $domWrap;\n\n\tvar gridNumHor;\n\tvar gridNumVer;\n\tvar gridWidthPercent;\n\tvar gridHeightPercent;\n\n\tvar productDatas = [];\n\tvar productSelected = [];\n\tvar itemElems = [];\n\n\tvar maxSelect = 4; // 最多选择个数\n\n\tvar displayManager = new DisplayManager();\n\n\tthis.constructor = function() {\n\t\tthis.super();\n\t\tthis.init();\n\t}\n\n\tthis.init = function() {\n\t\tproductDatas = $.extend(true, [], CONFIG.products);\n\t\t$domWrap = $('#listView');\n\t\tcreate();\n\t\tinitEvent();\n\t}\n\n\tthis.activate = function() {\n\t\tthis.active = true;\n\t\t$domWrap.show();\n\t\tsetTimeout(function() {\n\t\t\t$domWrap.addClass('active');\n\t\t}, 50);\n\t}\n\n\tthis.inactivate = function() {\n\t\tthis.active = false;\n\t\t$domWrap.addClass('inactive');\n\t\tsetTimeout(function() {$domWrap.hide();}, 1000);\n\t}\n\n\t// 重置大小，位置\n\tthis.reset = function() {\n\t\tvar winWidth = window.innerWidth;\n\t\tvar winHeight = window.innerHeight;\n\n\t\tvar gridWidth = 400;\n\t\tvar gridHeight = 400;\n\n\t\tgridNumHor = Math.round(winWidth/gridWidth);\n\t\tgridNumVer = Math.round(winHeight/gridHeight);\n\n\t\tgridWidthPercent = 100 / (gridNumHor === 0 ? 1 : gridNumHor);\n\t \tgridHeightPercent = 100 / (gridNumVer === 0 ? 1 : gridNumVer);\n\n\n\t\tvar left;\n\t\tvar top;\n\t \tif (itemElems.length) {\n\t \t\tvar max = Math.max(productDatas.length, gridNumHor * gridNumVer);\n\n\t \t\tfor (var i = 0; i < max; i++) {\n\t\t \t\tleft = (i % gridNumHor) * gridWidthPercent;\n\t\t \t\ttop = Math.floor(i / gridNumHor) * gridHeightPercent;\n\n\t\t \t\tif (!itemElems[i]) {\n\t\t \t\t\titemElems[i] = $('<li data-preview-index=\"' + i + '\"><div></div></li>')[0];\n\t\t \t\t\t$domWrap.find('ul').append(itemElems[i]);\n\t\t \t\t}\n\n\t \t\t\t$(itemElems[i]).css({\n\t \t\t\t\tleft: left + '%',\n\t \t\t\t\ttop: top + '%',\n\t \t\t\t\twidth: gridWidthPercent + '%',\n\t \t\t\t\theight: gridHeightPercent + '%'\n\t \t\t\t});\n\t \t\t}\n\t \t\titemElems.length = max;\n\t \t\t$domWrap.find('.list-wrap li:gt(' + (max - 1) + ')').remove();\n\t \t}\n\t}\n\n\tthis.getSelected = function() {\n\n\t}\n\n\tfunction create() {\n\t\tvar htmlStr = '';\n\n\t \tproductDatas.forEach(function(productData, i) {\n\t \t\thtmlStr += '<li data-preview-index=\"' + i + '\"><div><img src=\"' + productData.imgUrl + '\" alt=\"\"></div></li>'\n\t \t});\t\n\t \thtmlStr = htmlStr;\n\t \t$domWrap.find('.list-wrap').html(htmlStr);\n\n\t \titemElems = [];\n\t \tArray.prototype.push.apply(itemElems,$domWrap.find('li'));\n\t \tthat.reset();\n\t}\n\n\tfunction initEvent() {\n\t\tfunction selectProducts(indexes) {\n\t\t\tvar $li = $domWrap.find('.list-wrap li');\n\t\t\t$li.removeClass('selected');\n\n\t\t\tif (indexes)\n\t\t\tindexes.forEach(function(index) {\n\t\t\t\t$li.eq(index).addClass('selected');\n\t\t\t});\n\n\t\t\tif (indexes && indexes.length) {\n\t\t\t\t$domWrap.addClass('show-control');\n\t\t\t} else {\n\t\t\t\t$domWrap.removeClass('show-control');\n\t\t\t}\n\t\t}\n\n\t\t$domWrap.on('click', 'li:lt(' + productDatas.length + ')', function() {\n\t\t\tvar previewIndex = $(this).data('previewIndex');\n\n\t\t\tvar productData = productDatas[previewIndex];\n\n\t\t\tif (productSelected.indexOf(productData) < 0) {\n\t\t\t\tproductSelected.push(productData);\n\t\t\t\tif (productSelected.length > maxSelect) {\n\t\t\t\t\tproductSelected.shift();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tproductSelected = productSelected.filter(function(product) {\n\t\t\t\t\treturn product !== productData;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tselectProducts(productSelected.map(function(product) {\n\t\t\t\treturn productDatas.indexOf(product);\n\t\t\t}));\n\t\t});\n\n\t\t$domWrap.on('click', '#clear', function() {\n\t\t\tproductSelected.length = 0;\n\t\t\tselectProducts();\n\t\t});\n\t\t$domWrap.on('click', '#go', function() {\n\t\t\tgoDisplay();\n\t\t});\n\t}\n\n\tfunction goDisplay() {\n\t\t$domWrap.removeClass('show-control').addClass('choosed');\n\t\tvar $li = $domWrap.find('.list-wrap li');\n\t\tvar selectedPos = calculateSubWindowSize(productSelected.length);\n\t\tvar index = 0;\n\n\t\tconsole.log(selectedPos);\n\n\t\tproductDatas.forEach(function(product, i) {\n\t\t\tif (index > productSelected.length - 1) return false;\n\t\t\tif (productSelected.indexOf(product) != -1) {\n\t\t\t\t$li.eq(i).css(selectedPos[index]);\n\t\t\t    index++;\t\t\t\n\t\t\t}\n\t\t});\n\n\t\tsetTimeout(function() {\n\t\t\tthat.inactive();\n\t\t\tthat.inactivateView('welcome');\n\t\t\tthat.activateView('display-manager', productSelected);\n\t\t});\n\t}\n});\n\nmodule.exports = ProductsPreview;\n\n\n\n// 创建精灵\n/*function createSprite() {\n\tvar spriteSize = 8;\n\tvar spriteMargin = 4;\n\n\tvar row = Math.ceil(productCfg.length / col);\n\tvar center = {row: row/2 - 0.5, col: col/2 - 0.5};\n\n\tproductCfg.forEach(function(cfg, i) {\n        var spriteMaterial = new THREE.SpriteMaterial({\n            opacity: 1,\n            color: 0xaaaaaa,\n            transparent: true,\n            map: new THREE.ImageUtils.loadTexture(cfg.imgUrl)\n        });\n\n        //spriteMaterial.depthTest = false;\n        //spriteMaterial.blending = THREE.AdditiveBlending;\n\n        var sprite = new THREE.Sprite(spriteMaterial);\n        cfg.sprite = sprite;// 存入config\n\n\n        // 精灵最终位置大小信息\n        cfg.sizeInfo = {\n        \tx: (i % col - center.col) * (spriteSize + spriteMargin),\n        \ty: -(Math.floor(i / col) - center.row) * (spriteSize + spriteMargin),\n        \tz: baseCrood.z + 10,\n        \ts: spriteSize // 精灵大小\n        }\n        console.log(cfg.sizeInfo);\n        cfg.sprite.position.copy(initCrood);\n        cfg.sprite.scale.set(0, 0, 0);\n\n        //cfg.sprite.position.set(cfg.sizeInfo.x, cfg.sizeInfo.y, cfg.sizeInfo.z);\n        //cfg.sprite.scale.set(1, 1, 1);\n\n        spriteBox.add(sprite);\n\t});\n\tscene.add(spriteBox);\n}\n\n// init Animate 初始动画\nfunction initAni() {\n\tlogoAni.playEntryAnimation(); return;\n\n\tvar aniCfg = $.extend(true, [], productCfg);\n\tvar circle = 2; // 旋转圈数\n\tvar timePass = 0; \n\n\taniCfg.forEach(function(cfg, i) {\n\t\tcfg.percent = 0; \n\t\tcfg.finalAngle = Math.PI * 2 * circle + Math.atan(cfg.sizeInfo.x / (baseCrood.z - initCrood.z));\n\t\tcfg.aniRadius = Math.sqrt(cfg.sizeInfo.x * cfg.sizeInfo.x + (baseCrood.z - initCrood.z) * (baseCrood.z - initCrood.z));\n\t\tcfg.delay = i * 200 + Math.random() * 100;\n\t\tcfg.aniDur = 5000 + parseInt(Math.random() * 1000); \n\t});\n\n\n\tvar currentAngle;\n\tvar finishNum = 0;\n\n\tvar aniTick = that.addTick(function(detal) {\n\t\ttimePass += detal;\n\n\t\t// 遍历更新精灵位置\n\t\taniCfg.forEach(function(cfg) {\n\t\t\tif (cfg.percent === 1) return;\n\n\t\t\tcfg.percent = (timePass - cfg.delay) / cfg.aniDur;\n\t\t\tcfg.percent = cfg.percent < 0 ? 0 : (cfg.percent > 1 ? 1: cfg.percent);\n\t\t\tcurrentAngle = cfg.finalAngle * cfg.percent;\n\n\t\t\tcfg.x = Math.sin(currentAngle) * cfg.aniRadius * cfg.percent;\n\t\t\tcfg.z = Math.cos(currentAngle) * cfg.aniRadius * cfg.percent + initCrood.z;\n\t\t\tcfg.y = (cfg.sizeInfo.y - initCrood.y) * cfg.percent;\n\n\t\t\tcfg.s = cfg.sizeInfo.s * cfg.percent;\n\n\t\t\tcfg.sprite.position.set(cfg.x, cfg.y, cfg.z);\n\t\t\tcfg.sprite.scale.set(cfg.s, cfg.s, cfg.s);\n\n\t\t\tif (cfg.percent === 1) {\n\t\t\t\tfinishNum ++;\n\t\t\t}\n\t\t});\n\n\t\tif (finishNum === aniCfg.length) {\n\t\t\t// 初始动画完成\n\t\t\tthis.isActive = true;\n\t\t\tsetTimeout(function() {\n\t\t\t\tthat.removeTick(aniTick);\n\t\t\t}, 0);\n\t\t}\n\t});\t\n}*/\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./js/product-preview.js\n ** module id = 146\n ** module chunks = 1\n **/","var View = require('./view.js');\nvar ProductPreview = require('./product-preview.js');\nvar Welcome = View.extend(function() {\n\tthis.name = 'welcome';\n\tthis.isInit = false;\n\n\tvar that = this;\n\tvar logoUrl = CONFIG.MEIZU_LOGO;\n\tvar particleDatas = [];\n\tvar camera; // 自身创建 camera\n\tvar cloud;\n\tvar baseCrood = new THREE.Vector3(0, 0, 0);\n\tvar renderTick;\n\n\tthis.constructor = function() {\n\t\tthis.super();\n        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 500);\n\n\t\tM3.scene.add(camera);\n        productPreview = new ProductPreview();\n\t}\n\n\tthis.activate = function() {\n\t\tif (!particleDatas.length) {\n\t\t\tvar img = new Image();\n\t\t\timg.src = logoUrl;\n\t\t\timg.onload = function() {\n\t\t\t\tparticleDatas = getParticlesData(img);\n\t\t\t\tcreateParticle();\n\t\t\t\tinit();\n\t\t\t}\n\t\t} else {\n\t\t\tinit();\t\t\n\t\t}\n\t}\n\n\tthis.inactivate = function() {\n\t\tthis.removeTick(renderTick); // 移除全部tick \n\t}\n\n\tthis.reset = function() {\n\t\tvar winWidth = window.innerWidth;\n\t\tvar winHeight = window.innerHeight;\n\n\t\tM3.renderer.setSize(winWidth, winHeight);\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n        camera.updateProjectionMatrix();\n\n\t\tcamera.position.set(0, 0, 250);\n\t\tcamera.lookAt(baseCrood);\n\t}\n\n\n\tfunction init() {\n\t\tthat.reset();\n\t\tplayEntryAnimation(function() {\n\t\t\tproductPreview.activate();\n\t\t});\t\n\t\trender();\n\t} \n\n\tfunction getParticlesData(img) {\n\t\tvar particleDatas = [];\n\t\tvar width = img.width;\n\t\tvar height = img.height;\n\n\t\t// 从canvas 读取颜色信息，创建粒子\n\t\tvar cvs = document.createElement('canvas');\n\t\tcvs.width = width;\n\t\tcvs.height = height;\n\t\tvar ctx = cvs.getContext('2d');\n\n\t\tctx.drawImage(img, 0, 0);\t\n\n\t\tvar pixs = ctx.getImageData(0, 0, width, height).data;\n\n\t\tfor (var i = 0; i < pixs.length; i += 4) {\n\t\t    var r = pixs[i],\n\t\t        g = pixs[i + 1],\n\t\t        b = pixs[i + 2],\n\t\t        a = pixs[i + 3];\n\n\t\t    if (b > 50) {\n\t\t        var x = (i % (4 * width)) / 4 - width/2;\n\t\t        var y = -(parseInt(i / (4 * width)) - height/2);\n\n\t\t        particleDatas.push({\n\t\t        \t'color': 'rgba(' + r + ', ' + g + ', ' + b + ', ' + a + ')',\n\t\t        \t//'color': '#abcdef',\n\t\t        \t'size': {'x': x, 'y': y}\n\t\t        });\n\t\t    }\n\t\t}\n\n\t\t// 动画相关设置\n\t\tvar circleNum = 2;\n\t\tvar angleV = Math.PI * 2 / 4000; // 每秒转一圈, 转速\n\t\tvar radiusV = 30; // 每旋转一圈半径增长长度\n\n\t\tparticleDatas.forEach(function(particleData, i) {\n\n\t\t\tparticleData.radiusV = radiusV;\n\t\t\tparticleData.angleV = angleV * (0.8 + Math.random() * 0.4);\n\t\t\tparticleData.percent = 0;\n\t\t\tparticleData.delay = 2000 + (particleData.size.x * particleData.size.y) / 1;\n\t\t\tparticleData.initRadius = Math.sqrt(particleData.size.x * particleData.size.x + particleData.size.y * particleData.size.y);\n\t\t\tparticleData.angleY = Math.acos(particleData.size.y * Math.random()/particleData.initRadius); // 与 Y 轴夹角\n\n\t\t\tparticleData.initAngle = particleData.size.x < 0 ? Math.PI : 0;\n\t\t\tparticleData.currentAngle = particleData.initAngle;\n\t\t\tparticleData.finalAngle = (circleNum + Math.random()) * Math.PI * 2// * (Math.random() > 0.5 ? 1 : -1);\n\t\t\tparticleData.dur = (particleData.finalAngle - particleData.initAngle) / particleData.angleV;\n\n\t\t});\n\n\t\treturn particleDatas;\n\t}\n\n\tfunction createParticle() {\n\n        var geom = new THREE.Geometry();\n        var material = new THREE.PointCloudMaterial({\n            size: 1,\n            transparent: true,\n            opacity: 0.6,\n            vertexColors: true,\n\n            sizeAttenuation: true,\n            color: 0xffffff\n        });\n\n\t\tparticleDatas.forEach(function(particleData) {\n\t\t\tvar particle = new THREE.Vector3(particleData.size.x, particleData.size.y, 0);\n\t\t\tgeom.vertices.push(particle);\n\n\t\t\tvar color = new THREE.Color(particleData.color);\n\t\t\tgeom.colors.push(color);\n\t\t});\n\n        cloud = new THREE.PointCloud(geom, material);\n        cloud.name = \"particles\";\n        M3.scene.add(cloud);\n\t}\n\n\tfunction playEntryAnimation(callback) {\n\t\tvar timePass = 0;\n\t\tvar aniDatas = $.extend(true, [], particleDatas);\n\t\t//aniDatas = [/*$.extend(true, [], particleDatas)[0], */aniDatas[aniDatas.length-1]];\n\t\tvar aniDoneNum = 0;\n\n\t\tvar aniTick = that.addTick(function(detal) {\n\t\t\ttimePass += detal;\n\t\t\taniDoneNum = 0;\n\n\t\t\taniDatas.forEach(function(aniData, i) {\n\t\t\t\tif (timePass < aniData.delay || aniData.percent === 1) { if (aniData.percent === 1) aniDoneNum++; return; };\n\t\t\t\taniData.percent = (timePass - aniData.delay) / aniData.dur;\n\t\t\t\taniData.percent = aniData.percent > 1 ? 1 : aniData.percent;\n\n\t\t\t\taniData.currentAngle = easing.easeInOutCubic(timePass - aniData.delay, aniData.initAngle, aniData.finalAngle, aniData.dur);\n\n\t\t\t\taniData.currentRadius = Math.abs((aniData.currentAngle - aniData.initAngle) / (Math.PI * 2)) * aniData.radiusV + aniData.initRadius;\n\n\t\t\t\taniData.size.y = aniData.currentRadius * Math.cos(aniData.angleY);\n\t\t\t\taniData.size.x = aniData.currentRadius * Math.abs(Math.sin(aniData.angleY)) * Math.cos(aniData.currentAngle);\n\t\t\t\taniData.size.z = aniData.currentRadius * Math.abs(Math.sin(aniData.angleY)) * Math.sin(aniData.currentAngle);\n\n\t\t\t\tcloud.geometry.vertices[i].set(aniData.size.x, aniData.size.y, aniData.size.z)\n\n\t\t\t});\n\n\t\t\tcloud.geometry.verticesNeedUpdate = true;\n\n\t\t\tif (aniDoneNum/aniDatas.length > 0.6 || timePass > 10000) {\n\t\t\t\tcallback && callback(); callback = false;\n\t\t\t}\n\n\t\t\tcloud.rotation.x += 0.0005;\n\t\t\tcloud.rotation.y += 0.0005;\n\t\t\tcloud.rotation.z += 0.0005;\n\t\t\tif (aniDoneNum/aniDatas.length > 0.99) {\n\t\t\t\t//that.removeTick(aniTick);\n\t\t\t}\n\t\t});\n\t}\n\n\t// render \n\tfunction render() {\n\t\trenderTick = that.addTick(function() {\n\t\t\tM3.renderer.render(M3.scene, camera);\n\t\t});\n\t}\n});\n\nmodule.exports = Welcome;\n\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./js/welcome.js\n ** module id = 148\n ** module chunks = 1\n **/"],"sourceRoot":""}